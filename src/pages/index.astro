---
import Base from "../layouts/Base.astro";
import { BRAND } from "../config";

const postsGlob = import.meta.glob('./posts/*.{md,mdx}', { eager: true });
const posts = Object.entries(postsGlob).map(([path, mod]) => {
  const filename = path.replace(/^\.\/posts\//, '').replace(/\.(md|mdx)$/, '');
  return {
    url: `/posts/${filename}`,
    fm: mod.frontmatter ?? {}
  };
}).sort((a, b) => new Date(b.fm.pubDate) - new Date(a.fm.pubDate)).slice(0,6);
---
<Base title={BRAND.title} description={BRAND.description} canonical={`${BRAND.homeUrl}/`}>
  <section>
    <h1>Writing</h1>
    <p class="post-meta">{BRAND.description}</p>
    {posts.map(p => (
      <div class="post-card">
        <a href={p.url}><strong>{p.fm.title}</strong></a>
        <div class="post-meta">{p.fm.pubDate} Â· {p.fm.tags?.map((t)=> (<a class="tag" href={`/tags/${t}`}>{t}</a>))}</div>
        <p>{p.fm.description}</p>
      </div>
    ))}
  </section>
</Base>