---
title: "Stop Editing Xcode & Gradle: Expo CNG + Config Plugins Explained"
description: "A practical, code-first guide to Expo's Continuous Native Generation (CNG) workflow and building a Firebase config plugin that automates native setup for iOS and Android."
pubDate: "2025-11-04"
tags: ["Expo", "React Native", "CNG", "Config Plugins", "Firebase", "iOS", "Android"]
canonical: "https://kausthubh.in/posts/expo-cng-config-plugin"
---

Expo's new **CNG workflow (Continuous Native Generation)** fundamentally changes how we work with the `ios/` and `android/` directories in React Native projects. Instead of editing native code manually, CNG treats these folders as **generated artifacts** ‚Äî rebuilt on demand from configuration, dependencies, and plugins.

This unlocks a cleaner workflow: you focus on JS + config, while Expo regenerates your native project reliably and consistently.

## What is Continuous Native Generation?

**Continuous Native Generation (CNG)** is Expo's evolution of the managed workflow. Rather than maintaining Xcode and Gradle files by hand, CNG regenerates them using your app config, package dependencies, and **Config Plugins**.

### Why CNG matters

- ‚úÖ Clean upgrades across Expo SDK versions  
- ‚úÖ Less native boilerplate to maintain  
- ‚úÖ Clear separation of app logic vs platform scaffolding  
- ‚úÖ Native changes automated through plugins instead of manual edits  

> CNG doesn't mean you'll *never* touch native code ‚Äî it ensures you touch it **only when truly required**, and encapsulate those changes cleanly in reusable plugins.

---

## Automating Native Config with Plugins

In a typical RN app, adding something like Firebase Analytics means touching:

- Gradle build files  
- Podfile  
- `AppDelegate` / `MainApplication`  
- Copying Google credentials files  

With **Expo Config Plugins**, these steps become automated ‚Äî ensuring your native project is always correct whenever you run:

```bash
expo prebuild
```

Let's build a plugin that wires up Firebase Analytics on both platforms.

---

## üìÅ Step 1: Project Structure

```bash
mkdir -p plugins/expo-analytics-config-plugin/src
cd plugins/expo-analytics-config-plugin
npm init -y
```

---

## ‚öô Step 2: TypeScript Config

`tsconfig.json`

```json
{
  "compilerOptions": {
    "outDir": "build",
    "rootDir": "src",
    "module": "commonjs",
    "target": "es2019",
    "lib": ["es2019"],
    "declaration": true,
    "strict": true,
    "esModuleInterop": true
  },
  "include": ["src"]
}
```

---

## üß† Step 3: Plugin Types

```ts
import { ConfigPlugin } from "@expo/config-plugins";

type Options = {
  android?: {
    googleServicesJsonPath?: string;
    googleServicesVersion?: string;
    analyticsCollectionEnabled?: boolean;
  };
  ios?: {
    googleServicesPlistPath?: string;
    automaticScreenReportingEnabled?: boolean;
  };
};
```

---

## ü§ñ Step 4: Android Config

Adds Google services & Firebase Analytics to Gradle:

```ts
import { withProjectBuildGradle, withAppBuildGradle } from "@expo/config-plugins";

const withAndroidConfiguration: ConfigPlugin<Options> = (config, options) => {
  config = withProjectBuildGradle(config, (config) => {
    const version = options.android?.googleServicesVersion ?? "4.4.2";
    if (!config.modResults.contents.includes("com.google.gms:google-services")) {
      config.modResults.contents = config.modResults.contents.replace(
        /dependencies\s*{\s*/,
        `$&        classpath("com.google.gms:google-services:${version}")\n`
      );
    }
    return config;
  });

  config = withAppBuildGradle(config, (config) => {
    if (!config.modResults.contents.includes("firebase-analytics-ktx")) {
      config.modResults.contents = config.modResults.contents.replace(
        /dependencies\s*{\s*/,
        `$&    implementation("com.google.firebase:firebase-analytics-ktx")\n`
      );
    }
    return config;
  });

  return config;
};
```

---

## üçè Step 5: iOS Config

Adds Firebase pods and initializes Firebase:

```ts
import { withPodfile, withAppDelegate } from "@expo/config-plugins";

const withIosConfiguration: ConfigPlugin<Options> = (config) => {
  config = withPodfile(config, (config) => {
    if (!config.modResults.contents.includes("Firebase/Analytics")) {
      config.modResults.contents += '\npod "Firebase/Analytics"\n';
    }
    return config;
  });

  config = withAppDelegate(config, (config) => {
    const firebaseInit = config.modResults.language === "objc"
      ? "[FIRApp configure];"
      : "FirebaseApp.configure()";

    config.modResults.contents = config.modResults.contents.replace(
      /didFinishLaunchingWithOptions.*\{\n/,
      `$&    ${firebaseInit}\n`
    );
    return config;
  });

  return config;
};
```

---

## üîê Step 6: Copy Credentials

```ts
import { withDangerousMod } from "@expo/config-plugins";
import fs from "fs";
import path from "path";

const withCredentialsCopy: ConfigPlugin<Options> = (config, options) => {
  return withDangerousMod(config, ["android", async (config) => {
    const src = options.android?.googleServicesJsonPath;
    if (!src) return config;

    const dest = path.join(config.modRequest.platformProjectRoot, "app", "google-services.json");
    fs.copyFileSync(path.resolve(config.modRequest.projectRoot, src), dest);
    return config;
  }]);
};
```

---

## üß© Step 7: Export Plugin

```ts
import { createRunOncePlugin } from "@expo/config-plugins";

const withFirebaseAnalytics: ConfigPlugin<Options> = (config, options) => {
  config = withAndroidConfiguration(config, options);
  config = withIosConfiguration(config, options);
  config = withCredentialsCopy(config, options);
  return config;
};

export default createRunOncePlugin(
  withFirebaseAnalytics,
  "expo-analytics-config-plugin",
  "1.0.0"
);
```

---

## üõ† Step 8: Use It in `app.config.ts`

```ts
plugins: [
  [
    "./plugins/expo-analytics-config-plugin",
    {
      android: {
        googleServicesJsonPath: "./credentials/android/google-services.json",
        googleServicesVersion: "4.4.2",
        analyticsCollectionEnabled: true
      },
      ios: {
        googleServicesPlistPath: "./credentials/ios/GoogleService-Info.plist",
        automaticScreenReportingEnabled: true
      }
    }
  ]
];
```

---

## ‚úÖ Test It

```bash
cd plugins/expo-analytics-config-plugin
npm run build

cd ../..
npx expo prebuild --clean
```

---

## üéØ Final Thoughts

With Expo‚Äôs CNG workflow and config plugins:

- Native setup becomes repeatable, automatic, and safe
- Your repo stays clean ‚Äî no random Gradle/Xcode edits
- Upgrades and CI builds become painless

This Firebase example is just the beginning ‚Äî once you build one plugin, you start thinking in automation by default.

**Full demo repo:** https://github.com/androidguy30/Expo-Config-Demo
